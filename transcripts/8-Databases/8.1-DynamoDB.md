# 8.1 DynamoDB

## Basics (ya lo sabés)
- NoSQL, serverless, hasta 1M rps
- Max object: 400KB (si más grande → S3 + referencia)
- CRUD + transactions (ACID)
- Eventually o Strongly consistent reads

## Capacity Modes

| Mode | Cuándo usar |
|------|-------------|
| Provisioned | Tráfico predecible, más barato |
| On-Demand | Tráfico impredecible, desarrollo, spikes |

## Primary Keys (IMPORTANTE)

### Opción 1: Solo Partition Key (HASH)
```
user_id (PK) | first_name | age
─────────────┼────────────┼────
abc123       │ John       │ 25
def456       │ Katie      │ 30
```
- Partition key DEBE ser único

### Opción 2: Partition Key + Sort Key (Composite)
```
user_id (PK) | game_id (SK) | result
─────────────┼──────────────┼───────
abc123       │ game_001     │ WIN
abc123       │ game_002     │ LOSE
def456       │ game_001     │ WIN
```
- Combinación (PK + SK) debe ser única
- Sort key común: timestamp

## Indexes (CAE EN EXAMEN)

### LSI (Local Secondary Index)
- Mismo partition key, DIFERENTE sort key
- Se crea AL CREAR la tabla (no después)

### GSI (Global Secondary Index)
- Partition key DIFERENTE
- Se puede crear DESPUÉS de crear la tabla

```
REGLA: En DynamoDB solo podés buscar por PK + SK
       Si querés buscar por otro campo → necesitás index
```

## Features importantes

| Feature | Qué hace |
|---------|----------|
| TTL | Auto-delete rows después de X tiempo |
| Streams | Captura cambios (CDC), 24h retención |
| Global Tables | Multi-region active-active (necesita Streams) |

## DynamoDB Streams + Kinesis

```
DynamoDB Streams: 24h retención
Kinesis Data Streams: hasta 365 días

DynamoDB → Kinesis → Firehose → S3/Redshift/OpenSearch
```

## Patrón: S3 Metadata Indexing

```
S3 (archivos) → Lambda → DynamoDB (metadata)
                              │
                              ▼
                   Queries: "archivos por fecha"
                           "storage por cliente"
                           "archivos con tag X"
```

## DAX vs ElastiCache

| | DAX | ElastiCache |
|---|-----|-------------|
| Para qué | Cache de objetos/queries DynamoDB | Cache de computaciones |
| Integración | Transparente (no cambias código) | Manual |
| Latencia | Microsegundos | Milisegundos |
| Hot key problem | ✅ Lo resuelve | N/A |
| Nodos | Hasta 10 | Hasta 200 (Redis) |

```
Lecturas directas de DynamoDB    → DAX
Resultados de cálculos pesados   → ElastiCache
```

## Para el examen

```
Index después de crear tabla → GSI (no LSI)
Multi-region active-active   → Global Tables + Streams
Hot key / throttling         → DAX
Stream + más de 24h          → Kinesis Data Streams
Buscar metadata en S3        → Lambda + DynamoDB pattern
Cache de agregaciones        → ElastiCache (no DAX)
```
