# 7.4 Lambda@Edge - Solution Architecture

## Problema

Primera request tarda mucho si edge está lejos del origin.

```
Usuario Europa → Edge Europa → S3 us-east-1
                                    │
                              Latencia alta
                              (cruzar el Atlántico)
```

## Solución: Multi-Origin con Lambda@Edge

```
1. S3 bucket en us-east-1 (primario)
2. S3 bucket en eu-west-2 (réplica)
3. S3 Cross-Region Replication entre ambos
4. Lambda@Edge decide a cuál ir
```

```
Usuario USA → Edge USA → Lambda@Edge → "Cerca de us-east-1" → S3 us-east-1
Usuario EU  → Edge EU  → Lambda@Edge → "Cerca de eu-west-2" → S3 eu-west-2
```

## Diagrama

```
                    ┌─────────────────┐
                    │  Lambda@Edge    │
                    │ (origin request)│
                    └────────┬────────┘
                             │
              ┌──────────────┴──────────────┐
              │                             │
              ▼                             ▼
    S3 us-east-1 ◄───── CRR ─────► S3 eu-west-2
         │                              │
         ▼                              ▼
    Users Americas                 Users Europe
```

## Código Lambda@Edge (simplificado)

```javascript
// Origin Request trigger
if (viewerCountry in ['US', 'CA', 'MX', 'BR']) {
  request.origin = 's3-us-east-1'
} else {
  request.origin = 's3-eu-west-2'
}
```

## Para el examen

```
Reducir latencia primera request   → Multi-origin + Lambda@Edge
Datos iguales en varios buckets    → S3 Cross-Region Replication
Lambda@Edge decide origin          → Origin Request trigger
```
