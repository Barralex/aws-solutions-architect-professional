# 4.1 AWS CloudTrail

## Resumen
CloudTrail proporciona gobernanza, compliance y auditorÃ­a para tu cuenta AWS. EstÃ¡ habilitado por defecto y registra todos los eventos/llamadas API realizadas dentro de tu cuenta AWS.

---

## Conceptos Clave

### 1. Â¿QuÃ© es CloudTrail?

**PropÃ³sito:**
- Gobernanza, compliance y auditorÃ­a
- Obtener historial de eventos/API calls de tu cuenta AWS
- Registra acciones desde: Console, SDK, CLI, otros servicios AWS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AWS CLOUDTRAIL                            â”‚
â”‚                                                             â”‚
â”‚  QuiÃ©n hizo quÃ©, cuÃ¡ndo y desde dÃ³nde                       â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Console  â”‚  â”‚   CLI    â”‚  â”‚   SDK    â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚       â”‚             â”‚             â”‚                         â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                     â–¼                                       â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚             â”‚  CloudTrail  â”‚                                â”‚
â”‚             â”‚              â”‚                                â”‚
â”‚             â”‚  Registra    â”‚                                â”‚
â”‚             â”‚  TODO        â”‚                                â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                    â”‚                                        â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚        â–¼           â–¼           â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚    S3    â”‚ â”‚CloudWatchâ”‚ â”‚ Athena   â”‚                   â”‚
â”‚  â”‚ (logs)   â”‚ â”‚  Logs    â”‚ â”‚ (query)  â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Si un recurso es eliminado en AWS, primero mira CloudTrail.**

### 2. Tipos de Eventos

CloudTrail tiene **tres tipos** de eventos:

| Tipo | QuÃ© registra | Por defecto | Ejemplo |
|------|--------------|-------------|---------|
| **Management Events** | Operaciones en recursos AWS | âœ… SÃ | CreateVPC, AttachRolePolicy, CreateSubnet |
| **Data Events** | Operaciones EN los datos | âŒ NO (alto volumen) | S3 GetObject/PutObject, Lambda Invoke |
| **Insights Events** | Actividad inusual detectada | âŒ NO (costo extra) | Picos anormales de API calls |

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MANAGEMENT EVENTS vs DATA EVENTS                           â”‚
â”‚                                                             â”‚
â”‚  Management = "QuiÃ©n configurÃ³ el bucket S3"               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ CreateBucket, DeleteBucket,         â”‚                   â”‚
â”‚  â”‚ PutBucketPolicy, etc.               â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                             â”‚
â”‚  Data = "QuiÃ©n leyÃ³/escribiÃ³ objetos en el bucket"         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ GetObject, PutObject, DeleteObject  â”‚ â† ALTO VOLUMEN   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                             â”‚
â”‚  âš ï¸ Data Events NO estÃ¡n habilitados por defecto           â”‚
â”‚     porque generan MUCHO trÃ¡fico y cuestan mÃ¡s             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Management Events - Read vs Write

Los Management Events se separan en:

| Tipo | DescripciÃ³n | Ejemplo |
|------|-------------|---------|
| **Read Events** | NO modifican recursos | ListUsers, DescribeEC2Instances |
| **Write Events** | SÃ pueden modificar recursos | DeleteTable, CreatePolicy |

**Puedes filtrar quÃ© registrar:** solo Read, solo Write, o ambos.

### 4. CloudTrail Insights

**Â¿QuÃ© hace?**
Detecta actividad INUSUAL en tu cuenta automÃ¡ticamente.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLOUDTRAIL INSIGHTS                                        â”‚
â”‚                                                             â”‚
â”‚  Analiza Management Events normales                         â”‚
â”‚          â†“                                                  â”‚
â”‚  Crea baseline de actividad                                 â”‚
â”‚          â†“                                                  â”‚
â”‚  Detecta anomalÃ­as:                                         â”‚
â”‚                                                             â”‚
â”‚  â€¢ Aprovisionamiento inexacto de recursos                  â”‚
â”‚  â€¢ Alcanzar lÃ­mites de servicio                            â”‚
â”‚  â€¢ Picos de acciones IAM                                   â”‚
â”‚  â€¢ Gaps en actividad de mantenimiento                      â”‚
â”‚                                                             â”‚
â”‚  Genera "Insights Events" cuando detecta algo raro         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. RetenciÃ³n de Eventos

**Por defecto:** 90 dÃ­as en CloudTrail

**Para retenciÃ³n mÃ¡s larga:**
1. Enviar logs a S3
2. Usar Athena para analizar

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RETENCIÃ“N DE LOGS                                          â”‚
â”‚                                                             â”‚
â”‚  CloudTrail (90 dÃ­as)                                       â”‚
â”‚        â”‚                                                    â”‚
â”‚        â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚     S3       â”‚ â”€â”€â–º â”‚   Athena     â”‚                     â”‚
â”‚  â”‚ (ilimitado)  â”‚     â”‚  (anÃ¡lisis)  â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                             â”‚
â”‚  PatrÃ³n tÃ­pico para auditorÃ­a de largo plazo               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Para el Examen

1. **CloudTrail** = auditorÃ­a de TODAS las API calls en tu cuenta AWS
2. **Habilitado por defecto** = sÃ­, pero solo Management Events
3. **Data Events** = NO por defecto (alto volumen, S3 GetObject, Lambda Invoke)
4. **Insights** = detecta actividad INUSUAL automÃ¡ticamente
5. **RetenciÃ³n** = 90 dÃ­as default, S3 + Athena para mÃ¡s tiempo
6. **Algo se borrÃ³?** = PRIMERO mira CloudTrail

---

## Arquitecturas de SoluciÃ³n (SA Pro)

### 6. CloudTrail + EventBridge

**PatrÃ³n clave para alertas en tiempo real:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLOUDTRAIL + EVENTBRIDGE                                   â”‚
â”‚                                                             â”‚
â”‚  API Call (DeleteTable, AssumeRole, etc.)                  â”‚
â”‚        â”‚                                                    â”‚
â”‚        â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â”‚  CloudTrail  â”‚ â† Registra TODO                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ EventBridge  â”‚ â”€â”€â–º â”‚   SNS/SQS/   â”‚                     â”‚
â”‚  â”‚   (regla)    â”‚     â”‚   Lambda     â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                             â”‚
â”‚  Ejemplos de APIs a monitorear:                            â”‚
â”‚  â€¢ DeleteTable (DynamoDB)                                  â”‚
â”‚  â€¢ AssumeRole (IAM)                                        â”‚
â”‚  â€¢ AuthorizeSecurityGroupIngress (EC2)                     â”‚
â”‚                                                             â”‚
â”‚  ğŸ’¡ EventBridge = forma MÃS RÃPIDA de reaccionar           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7. CloudTrail + S3 (largo plazo)

**Arquitectura para compliance:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLOUDTRAIL â†’ S3 (cada 5 minutos)                          â”‚
â”‚                                                             â”‚
â”‚  CloudTrail                                                 â”‚
â”‚      â”‚                                                      â”‚
â”‚      â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â”‚     S3       â”‚                                          â”‚
â”‚  â”‚              â”‚                                          â”‚
â”‚  â”‚ Mejoras:     â”‚                                          â”‚
â”‚  â”‚ â€¢ SSE-S3/KMS â”‚ â† EncriptaciÃ³n                          â”‚
â”‚  â”‚ â€¢ Versioning â”‚ â† Evita borrados accidentales           â”‚
â”‚  â”‚ â€¢ MFA Delete â”‚ â† ProtecciÃ³n extra                      â”‚
â”‚  â”‚ â€¢ Lifecycle  â”‚ â† Mover a Glacier                       â”‚
â”‚  â”‚ â€¢ Object Lockâ”‚ â† Inmutable (compliance)                â”‚
â”‚  â”‚ â€¢ Integrity  â”‚ â† ValidaciÃ³n de logs                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                                                             â”‚
â”‚  S3 Events â†’ SQS/SNS/Lambda (procesamiento)                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8. Multi-cuenta con Cuenta de Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LOGS CENTRALIZADOS EN CUENTA DE SEGURIDAD                 â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚ Account Aâ”‚     â”‚ Account Bâ”‚                             â”‚
â”‚  â”‚CloudTrailâ”‚     â”‚CloudTrailâ”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚       â”‚                â”‚                                    â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚     Security Account          â”‚                          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                          â”‚
â”‚  â”‚  â”‚   S3 Bucket (logs)     â”‚  â”‚                          â”‚
â”‚  â”‚  â”‚                        â”‚  â”‚                          â”‚
â”‚  â”‚  â”‚ S3 Bucket Policy:      â”‚  â”‚                          â”‚
â”‚  â”‚  â”‚ Allow CloudTrail from  â”‚  â”‚                          â”‚
â”‚  â”‚  â”‚ Account A y B          â”‚  â”‚                          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                             â”‚
â”‚  ğŸ’¡ Cross-account = S3 Bucket Policy                       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9. CloudTrail + CloudWatch Logs (alertas por conteo)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DETECTAR ACTIVIDAD INUSUAL                                 â”‚
â”‚                                                             â”‚
â”‚  CloudTrail â†’ CloudWatch Logs                               â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â–¼                                        â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚            â”‚Metric Filter â”‚ â† Cuenta ocurrencias           â”‚
â”‚            â”‚              â”‚   de API especÃ­fica            â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                   â”‚                                         â”‚
â”‚                   â–¼                                         â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚            â”‚ CloudWatch   â”‚                                â”‚
â”‚            â”‚   Alarm      â”‚                                â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                   â”‚                                         â”‚
â”‚                   â–¼                                         â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚            â”‚     SNS      â”‚ â†’ Lambda/Email                 â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                             â”‚
â”‚  Casos de uso:                                             â”‚
â”‚  â€¢ Contar TerminateInstances                               â”‚
â”‚  â€¢ Detectar muchas API calls denegadas (ataque?)           â”‚
â”‚  â€¢ Contar API calls por usuario                            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10. Organization Trail

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ORGANIZATION TRAIL                                         â”‚
â”‚                                                             â”‚
â”‚  Management Account                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  Organization Trail (se crea ACÃ) â”‚                    â”‚
â”‚  â”‚            â”‚                       â”‚                    â”‚
â”‚  â”‚            â–¼                       â”‚                    â”‚
â”‚  â”‚       S3 Bucket                    â”‚                    â”‚
â”‚  â”‚  /account-id-1/logs               â”‚                    â”‚
â”‚  â”‚  /account-id-2/logs               â”‚                    â”‚
â”‚  â”‚  /account-id-3/logs               â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚         â–²          â–²          â–²                            â”‚
â”‚         â”‚          â”‚          â”‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚Member 1 â”‚ â”‚Member 2 â”‚ â”‚Member 3 â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                             â”‚
â”‚  ğŸ’¡ Se configura en Management Account                     â”‚
â”‚     Monitorea TODAS las cuentas miembro                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11. CuÃ¡ndo usar cada destino

| Necesidad | Destino | Tiempo |
|-----------|---------|--------|
| Reaccionar inmediatamente | **EventBridge** | Segundos |
| Contar/detectar anomalÃ­as | **CloudWatch Logs** | Minutos |
| AnÃ¡lisis largo plazo | **S3 + Athena** | 5 min delivery |

**Nota:** Los eventos de CloudTrail pueden tardar hasta 15 minutos en aparecer.

---

*Siguiente: 4.2 KMS*
