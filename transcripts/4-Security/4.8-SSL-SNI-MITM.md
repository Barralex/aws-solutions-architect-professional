# 4.8 SSL Encryption, SNI & MITM

**Curso:** AWS Solutions Architect Professional (SAP-C02)
**Sección:** 4 - Security
**Duración:** 8 min

---

## Resumen

SSL/TLS encrypts connections. SNI permite múltiples certificados SSL en un server (ALB/NLB/CloudFront, NO CLB). MITM se previene con HTTPS + DNSSEC.

---

## 1. SSL/TLS Basics

```
┌─────────────────────────────────────────────────────────────┐
│  SSL = Secure Socket Layer (viejo)                          │
│  TLS = Transport Layer Security (nuevo)                     │
│                                                             │
│  Todos dicen "SSL" pero en realidad es TLS                 │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  HANDSHAKE (simplificado)                                   │
│                                                             │
│  1. Asymmetric encryption (costoso en CPU)                 │
│     └── Solo para intercambiar una clave simétrica         │
│                                                             │
│  2. Symmetric encryption (barato en CPU)                   │
│     └── Toda la comunicación después del handshake         │
│                                                             │
│  Client ──[asymmetric]──► Server                           │
│         intercambian symmetric key                          │
│                                                             │
│  Client ◄──[symmetric]──► Server                           │
│         comunicación encriptada                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. SNI - Server Name Indication

```
┌─────────────────────────────────────────────────────────────┐
│  PROBLEMA:                                                  │
│  Un servidor con múltiples sitios, cada uno con su SSL     │
│  ¿Cómo sabe qué certificado usar?                          │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  SOLUCIÓN: SNI                                              │
│                                                             │
│  Cliente dice en el handshake: "Quiero www.mycorp.com"     │
│  Server responde con el certificado correcto               │
│                                                             │
│  ┌──────────────────────────────────────────────┐          │
│  │                    ALB                        │          │
│  │  ┌────────────┐    ┌────────────┐            │          │
│  │  │ SSL cert 1 │    │ SSL cert 2 │            │          │
│  │  │ mycorp.com │    │ domain.com │            │          │
│  │  └─────┬──────┘    └─────┬──────┘            │          │
│  └────────┼─────────────────┼───────────────────┘          │
│           │                 │                               │
│           ▼                 ▼                               │
│     Target Group 1    Target Group 2                        │
└─────────────────────────────────────────────────────────────┘
```

### Compatibilidad SNI

| Load Balancer | SNI Support |
|---------------|-------------|
| **ALB** | ✅ Sí |
| **NLB** | ✅ Sí |
| **CloudFront** | ✅ Sí |
| **CLB (Classic)** | ❌ NO |

**Si usás CLB:** un CLB por aplicación (no puede tener múltiples certs)

---

## 3. Man-in-the-Middle (MITM) Attack

```
┌─────────────────────────────────────────────────────────────┐
│  HTTP (sin SSL) = VULNERABLE                                │
│                                                             │
│  User ────► Pirate ────► Server                            │
│             (ve todo,                                       │
│              modifica todo)                                 │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  HTTPS (con SSL) = PROTEGIDO                                │
│                                                             │
│  User ────► Pirate ────► Server                            │
│             │                                               │
│             └── Intenta enviar fake SSL cert               │
│                 User detecta que es falso                  │
│                 Conexión rechazada                         │
│                                                             │
│  EXCEPTO si el pirata infectó la máquina del user          │
│  y le instaló su cert como "trusted"                       │
└─────────────────────────────────────────────────────────────┘
```

---

## 4. Cómo Prevenir MITM

```
┌─────────────────────────────────────────────────────────────┐
│  1. USAR HTTPS                                              │
│     └── SSL/TLS certificates                               │
│     └── Contenido encriptado client ↔ server               │
│                                                             │
│  2. USAR DNSSEC                                             │
│     └── Protege contra DNS spoofing                        │
│     └── Evita que te redirijan a server malicioso          │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  ROUTE 53 + DNSSEC                                          │
│                                                             │
│  ✅ Domain Registration con DNSSEC                         │
│  ✅ DNS Service con DNSSEC (desde Dec 2020, usa KMS)       │
│                                                             │
│  Alternativa: DNS custom en EC2 (Bind, dnsmasq, etc)       │
└─────────────────────────────────────────────────────────────┘
```

---

## Puntos Clave para el Examen

1. **SNI** = múltiples SSL certs en un server
2. **SNI funciona** en ALB, NLB, CloudFront
3. **SNI NO funciona** en CLB (Classic Load Balancer)
4. **CLB sin SNI** = necesitás un CLB por aplicación
5. **MITM prevention** = HTTPS + DNSSEC
6. **Route 53** = soporta DNSSEC para domain registration y DNS service

