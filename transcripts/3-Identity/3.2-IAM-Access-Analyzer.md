# 3.2 IAM Access Analyzer

**Curso:** AWS Solutions Architect Professional (SAP-C02)
**Sección:** 3 - Identity & Federation
**Duración:** 3 min

---

## Resumen

IAM Access Analyzer es un servicio dentro de la consola de IAM que identifica recursos compartidos con entidades externas.

---

## Recursos Analizados

IAM Access Analyzer examina los siguientes recursos:
- **S3 Buckets**
- **IAM Roles**
- **KMS Keys**
- **Lambda Functions y Layers**
- **SQS Queues**
- **Secrets Manager Secrets**

---

## Zona de Confianza (Zone of Trust)

### Concepto
- Defines qué cuentas/organización son "de confianza"
- Todo acceso desde FUERA de la zona de confianza = **Finding** (hallazgo)

### Ejemplo con S3 Bucket

```
┌─────────────────────────────────────────────────────────────┐
│                    S3 BUCKET                                │
│                                                             │
│  Compartido con:                                            │
│  ├── Rol específico         ✅ Dentro de zona confianza    │
│  ├── Usuario IAM            ✅ Dentro de zona confianza    │
│  ├── VPC Endpoint           ✅ Dentro de zona confianza    │
│  ├── Cuenta externa         ⚠️  FINDING - fuera de zona    │
│  └── Cliente externo (IP)   ⚠️  FINDING - fuera de zona    │
└─────────────────────────────────────────────────────────────┘
```

---

## Funcionalidades Adicionales

### 1. Validación de Políticas

IAM Access Analyzer puede validar tus políticas IAM:
- Gramática correcta
- Mejores prácticas de seguridad
- Genera: avisos, advertencias, errores y sugerencias

### 2. Generación de Políticas (Policy Generation)

**Flujo:**
```
Lambda/App → Hace llamadas API → CloudTrail registra →
IAM Access Analyzer revisa (hasta 90 días) →
Genera política IAM con permisos mínimos necesarios
```

**Beneficio:** Genera políticas de **least privilege** basadas en uso real.

---

## Casos de Uso para el Examen

1. **Detectar acceso no autorizado** a recursos compartidos externamente
2. **Auditoría de seguridad** - encontrar buckets S3 públicos accidentalmente
3. **Generar políticas IAM** basadas en actividad real (CloudTrail)
4. **Validar políticas** antes de aplicarlas

---

## Diferencia con IAM Access Advisor

| IAM Access Advisor | IAM Access Analyzer |
|-------------------|---------------------|
| Ve permisos concedidos | Ve recursos compartidos externamente |
| Último acceso por servicio | Detecta acceso desde fuera de zona de confianza |
| Para reducir permisos de usuarios/roles | Para detectar recursos sobre-expuestos |

---

## Key Points para el Examen

1. **Zone of Trust** = Tu cuenta o tu AWS Organization
2. **Findings** = Acceso desde fuera de la zona de confianza
3. **Policy Generation** = Crea políticas basadas en CloudTrail (90 días)
4. **Recursos soportados:** S3, IAM Roles, KMS, Lambda, SQS, Secrets Manager

