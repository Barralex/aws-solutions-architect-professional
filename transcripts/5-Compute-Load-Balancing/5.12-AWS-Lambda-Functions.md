# 5.12 AWS Lambda - Functions

**Curso:** AWS Solutions Architect Professional (SAP-C02)
**Sección:** 5 - Compute & Load Balancing
**Duración:** ~10 min

---

## Resumen

Lambda = funciones serverless que corren código sin servers. Integraciones: API Gateway, S3, DynamoDB, EventBridge, SQS, SNS, Kinesis. Límites: 15 min timeout, 10GB RAM, 1000 concurrent executions. CodeDeploy para traffic shifting entre versiones.

---

## Integraciones principales

| Servicio | Qué hace con Lambda |
|----------|---------------------|
| **API Gateway** | Invoca Lambda desde REST API |
| **S3** | Trigger cuando se crea objeto |
| **DynamoDB** | Lee DynamoDB Streams |
| **Kinesis** | Lee data streams |
| **EventBridge** | Cron jobs, eventos |
| **SQS** | Lee mensajes de cola |
| **SNS** | Reacciona a notificaciones |
| **Cognito** | Pre/post authentication hooks |

---

## Límites importantes

| Límite | Valor |
|--------|-------|
| **Timeout** | 15 minutos máx |
| **RAM** | Hasta 10 GB |
| **CPU** | Linked to RAM (más RAM = más CPU) |
| **Concurrent executions** | 1000 (soft limit) |
| **Deployment package** | 50MB zipped, 250MB unzipped |
| **Container image** | 10 GB |
| **Temp storage** | 10 GB |
| **Payload sync** | 6 MB |
| **Payload async** | 256 KB |

---

## Concurrency

- Default: 1000 concurrent executions (compartido entre todas las funciones)
- Reserved concurrency: reserva capacidad para una función específica
- Si excede límite → throttle

### Problema sin reserved concurrency

```
ALB → Lambda ────────┐
API GW → Lambda ─────┼──► 1000 concurrent (compartido)
SDK/CLI → Lambda ────┘

Si ALB usa 990... API GW y SDK quedan throttled!
```

### Solución: Reserved concurrency
```
ALB → Lambda (700 reserved)
API GW → Lambda (200 reserved)
SDK/CLI → Lambda (100 reserved)
```

---

## CodeDeploy Traffic Shifting

Mover tráfico gradualmente de V1 a V2:

| Estrategia | Cómo funciona |
|------------|---------------|
| **Linear** | 10% cada N minutos hasta 100% |
| **Canary** | 10% por 5-30 min, si OK → 100% |
| **AllAtOnce** | Cambio inmediato |

Pre/Post traffic hooks para validar health.

---

## Monitoring

- **CloudWatch Logs**: execution logs
- **CloudWatch Metrics**: invocations, errors, latency, timeouts
- **X-Ray**: tracing (habilitar en config)

Requiere: IAM execution role con permisos a CloudWatch/X-Ray

---

## Puntos Clave Examen

1. **15 min timeout** - si necesitás más → NO Lambda
2. **1000 concurrent** - soft limit, puede aumentarse
3. **Reserved concurrency** - evita que una función throttlee a otras
4. **Docker en Lambda** - posible pero ECS/Fargate es preferido
5. **CodeDeploy** - Linear, Canary, AllAtOnce para traffic shifting

