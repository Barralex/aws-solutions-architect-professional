# 5.7 Amazon ECS

**Curso:** AWS Solutions Architect Professional (SAP-C02)
**Sección:** 5 - Compute & Load Balancing
**Duración:** ~12 min

---

## Resumen

ECS = correr contenedores Docker en AWS. Dos modos: EC2 (vos manejás las instancias) o Fargate (serverless). Conceptos: Cluster, Service, Task Definition, Task. ALB con dynamic port mapping. ECR para guardar imágenes.

---

## Conceptos clave

| Concepto | Qué es |
|----------|--------|
| **Cluster** | Agrupación lógica de recursos (EC2 o Fargate) |
| **Service** | Define cuántas tasks correr y cómo |
| **Task Definition** | JSON que define el contenedor (imagen, CPU, RAM) |
| **Task** | Instancia corriendo de una Task Definition |

---

## Dos tipos de launch

### EC2 Launch Type
- Vos manejás las instancias EC2
- Necesitás EC2 Instance Profile para registrar en ECS
- Podés usar Spot Instances

### Fargate Launch Type
- Serverless, no manejás infraestructura
- Solo definís CPU/RAM por task
- AWS escala automáticamente

---

## IAM Roles

```
EC2 Instance Profile
└─► Permite a EC2 registrarse en ECS, enviar logs

Task IAM Role
└─► Permite a cada TASK acceder a S3, DynamoDB, etc.
    (cada task puede tener rol diferente)
```

---

## ALB + Dynamic Port Mapping

```
ALB
 │
 ├─► EC2 Instance 1
 │     ├─ Task A (puerto 32001)
 │     └─ Task A (puerto 32002)
 │
 └─► EC2 Instance 2
       ├─ Task A (puerto 32003)
       └─ Task A (puerto 32004)

ALB encuentra automáticamente cada puerto
= Dynamic Port Mapping
```

---

## Networking Modes

| Modo | Qué hace |
|------|----------|
| **none** | Sin red |
| **bridge** | Red virtual de Docker |
| **host** | Usa la red de la EC2 directamente |
| **awsvpc** | Cada task tiene su propia ENI + IP privada (default en Fargate) |

---

## Secretos y Config

Inyectar en containers via environment variables:
- SSM Parameter Store
- Secrets Manager

---

## Auto Scaling

- ECS Service Auto Scaling = escala tasks
- Si usás EC2, también necesitás ASG para escalar las EC2
- Fargate = solo escalás tasks (más simple)

---

## Spot Instances en ECS

- EC2 type: instancias EC2 spot, si se reclaman → draining mode
- Fargate: Fargate Spot para tasks (más barato, puede interrumpirse)

---

## ECR (Elastic Container Registry)

- Guarda imágenes Docker
- Privado (tu cuenta) o público
- ECS hace pull via IAM role
- Soporta: vulnerability scanning, versioning, tags, lifecycle

---

## Puntos Clave Examen

1. **Task Definition** = JSON que define el contenedor
2. **EC2 Instance Profile** = para registrar EC2 en cluster
3. **Task IAM Role** = para que la task acceda a otros servicios
4. **Dynamic Port Mapping** = ALB encuentra puertos automáticamente
5. **awsvpc** = cada task tiene su propia ENI (default en Fargate)
6. **Fargate** = serverless, no manejás EC2

