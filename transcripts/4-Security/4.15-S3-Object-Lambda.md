# 4.15 S3 Object Lambda

**Curso:** AWS Solutions Architect Professional (SAP-C02)
**Sección:** 4 - Security
**Duración:** 3 min

---

## Resumen

S3 Object Lambda permite modificar objetos al vuelo cuando se recuperan, sin duplicar buckets. Usa Lambda functions conectadas a Access Points para transformar datos (redactar PII, enriquecer, convertir formatos).

---

## El Problema

```
┌─────────────────────────────────────────────────────────────┐
│  ESCENARIO: Un bucket, múltiples consumidores              │
│                                                             │
│  s3://ecommerce-data/                                       │
│  └── customers.json                                         │
│                                                             │
│  • E-commerce App → necesita datos COMPLETOS               │
│  • Analytics App → necesita datos SIN PII (redactados)     │
│  • Marketing App → necesita datos ENRIQUECIDOS             │
│                                                             │
│  SOLUCIÓN MALA: 3 buckets con 3 versiones del archivo     │
│  SOLUCIÓN BUENA: S3 Object Lambda                          │
└─────────────────────────────────────────────────────────────┘
```

---

## Arquitectura

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  E-commerce App ──────────────────► S3 Bucket (directo)    │
│                                         │                   │
│                                         │                   │
│  Analytics App ──► S3 Object Lambda ──► │                   │
│                    Access Point         │                   │
│                         │               │                   │
│                    ┌────▼────┐          │                   │
│                    │ Lambda  │◄─────────┘                   │
│                    │ REDACT  │  (lee objeto original)       │
│                    └─────────┘                              │
│                                                             │
│                                                             │
│  Marketing App ──► S3 Object Lambda ──► S3 Bucket          │
│                    Access Point         │                   │
│                         │               │                   │
│                    ┌────▼────┐          │                   │
│                    │ Lambda  │◄─────────┘                   │
│                    │ ENRICH  │                              │
│                    └────┬────┘                              │
│                         │                                   │
│                    ┌────▼────┐                              │
│                    │Customer │                              │
│                    │Loyalty  │                              │
│                    │Database │                              │
│                    └─────────┘                              │
└─────────────────────────────────────────────────────────────┘
```

---

## Flujo detallado

```
┌─────────────────────────────────────────────────────────────┐
│  1. App hace GET a S3 Object Lambda Access Point           │
│  2. Access Point invoca Lambda                             │
│  3. Lambda lee objeto original del S3 Bucket               │
│  4. Lambda transforma el objeto (redacta/enriquece/etc)    │
│  5. Lambda retorna objeto modificado                       │
│  6. App recibe objeto transformado                         │
│                                                             │
│  ¡TODO SIN DUPLICAR DATOS!                                 │
└─────────────────────────────────────────────────────────────┘
```

---

## Casos de uso

| Caso | Qué hace Lambda |
|------|-----------------|
| **Redactar PII** | Elimina nombres, emails, SSN para analytics |
| **Enriquecer datos** | Agrega info de otras DBs (loyalty, CRM) |
| **Convertir formato** | XML → JSON al vuelo |
| **Watermark imágenes** | Agrega marca de agua específica por usuario |
| **Resize imágenes** | Redimensiona según el dispositivo |

---

## Puntos Clave para el Examen

1. **S3 Object Lambda** = transformar objetos AL VUELO sin duplicar buckets
2. **Requiere** S3 Access Point + Lambda + S3 Object Lambda Access Point
3. **Redactar PII** para analytics = S3 Object Lambda
4. **"Modify before retrieval"** = S3 Object Lambda
5. **Un bucket, múltiples vistas** = S3 Object Lambda

