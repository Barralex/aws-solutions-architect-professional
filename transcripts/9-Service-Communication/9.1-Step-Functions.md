# 9.1 Step Functions

## Qué es

- Orquestación visual de workflows serverless
- Máximo duración: **1 año**
- Incluye: secuencias, paralelo, condiciones, timeouts, error handling
- Human approval feature disponible

## Integraciones directas (sin Lambda)

- Lambda, Batch, ECS/Fargate
- DynamoDB, SNS, SQS
- EMR, Glue, SageMaker
- Otro Step Functions
- **200+ servicios via AWS SDK**

## Cómo triggear Step Functions

- Console, SDK, CLI
- Lambda
- API Gateway
- EventBridge
- CodePipeline
- Otro Step Function

## Tipos de tareas

| Tipo | Qué hace |
|------|----------|
| Lambda Task | Invoca Lambda |
| Activity Task | Worker externo (EC2, on-prem) que hace PULL |
| Service Task | Integración directa (ECS, DynamoDB, SNS, SQS) |
| Wait Task | Espera X tiempo o hasta timestamp |

**IMPORTANTE:** NO integra con Mechanical Turk → usar SWF

## Standard vs Express Workflows

| | Standard | Express |
|---|----------|---------|
| Duración máx | 1 año | 5 minutos |
| Inicio/seg | 2,000 | 100,000+ |
| Pricing | Por state transition | Por ejecución + duración |
| Historial | Sí (en consola) | No (CloudWatch Logs) |
| Ejecución | Exactly-once | At-least-once |

## Express: Sync vs Async

```
SYNC (espera resultado):
API Gateway → Step Function → espera → resultado → response

ASYNC (fire-and-forget):
API Gateway → Step Function → "started" → (ejecuta en background)
```

## Error Handling

```
Step Function
     │
     ├── Retry (dentro del state machine)
     │
     └── EventBridge → SNS → Alert (fuera del state machine)
```

## Para el examen

| Ves en pregunta | Respuesta |
|-----------------|-----------|
| Orquestar Lambda/servicios | Step Functions |
| Workflow > 5 min | Standard Workflow |
| Workflow rápido alto throughput | Express Workflow |
| Mechanical Turk integration | SWF (NO Step Functions) |
| Human approval en workflow | Step Functions |
| Orquestar sin código Lambda | Step Functions (Service Tasks) |
| Workflow máximo duration | 1 año |
