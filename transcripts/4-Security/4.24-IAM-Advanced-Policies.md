# 4.24 IAM Advanced Policies

**Curso:** AWS Solutions Architect Professional (SAP-C02)
**Sección:** 4 - Security
**Duración:** ~5 min

---

## Resumen

Condiciones avanzadas en IAM policies: SourceIP (restringir por IP cliente), RequestedRegion (restringir regiones), ResourceTag/PrincipalTag (basado en tags), MFA, PrincipalOrgID (solo cuentas de mi org).

---

## Condiciones clave

| Condición | Qué hace | Ejemplo |
|-----------|----------|---------|
| `aws:SourceIP` | Restringe por IP del cliente | Solo desde red corporativa |
| `aws:RequestedRegion` | Restringe regiones | Denegar eu-central-1 |
| `ec2:ResourceTag` | Tag del recurso | Project=DataAnalytics |
| `aws:PrincipalTag` | Tag del usuario | Department=Data |
| `aws:MultiFactorAuthPresent` | Requiere MFA | Solo stop/terminate con MFA |
| `aws:PrincipalOrgID` | Solo cuentas de mi org | Bucket solo para mi org |

---

## S3: Bucket vs Object permissions

```
┌─────────────────────────────────────────────────────┐
│  BUCKET-LEVEL (ListBucket)                         │
│  arn:aws:s3:::test                                 │
├─────────────────────────────────────────────────────┤
│  OBJECT-LEVEL (GetObject, PutObject, DeleteObject) │
│  arn:aws:s3:::test/*                               │
└─────────────────────────────────────────────────────┘
```

---

## Puntos Clave

1. **aws:SourceIP** - restringir a red corporativa
2. **aws:RequestedRegion** - bloquear/permitir regiones (útil en SCPs)
3. **aws:PrincipalOrgID** - resource policy solo para cuentas de mi org
4. **S3 ARN** - bucket = sin /*, objects = con /*

