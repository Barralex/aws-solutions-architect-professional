# 3.5 AWS Directory Services

**Curso:** AWS Solutions Architect Professional (SAP-C02)
**Sección:** 3 - Identity & Federation
**Duración:** 13 min

---

## Resumen

AWS Directory Services ofrece 3 opciones para integrar Microsoft Active Directory con AWS.

---

## ¿Qué es Microsoft Active Directory?

```
┌─────────────────────────────────────────────────────────────┐
│  MICROSOFT ACTIVE DIRECTORY                                 │
│                                                             │
│  Base de datos de objetos:                                  │
│  - Cuentas de usuario                                       │
│  - Computadoras                                             │
│  - Impresoras                                               │
│  - File shares                                              │
│  - Security groups                                          │
│                                                             │
│  Organización: Objetos → Trees → Forest                     │
└─────────────────────────────────────────────────────────────┘

Domain Controller: Servidor central que gestiona autenticación
                   (usuario + password sincronizados en todas las máquinas)
```

---

## Los 3 tipos de AWS Directory Services

| Tipo | Descripción | MFA | Trust con On-Premise |
|------|-------------|-----|---------------------|
| **AWS Managed Microsoft AD** | AD completo en AWS | ✅ | ✅ Two-way Forest Trust |
| **AD Connector** | Proxy hacia AD on-premise | ✅ | No (solo proxy) |
| **Simple AD** | AD básico compatible (Samba) | ❌ | ❌ |

---

## 1. AWS Managed Microsoft AD

### Características:
- AD completo desplegado en tu VPC
- Mínimo 2 Domain Controllers (en 2 AZs para HA)
- Soporta MFA
- Backups automáticos
- Replicación multi-región opcional

### Integraciones:
```
┌─────────────────────────────────────────────────────────────┐
│              AWS MANAGED MICROSOFT AD                       │
│                      (centro)                               │
│                         │                                   │
│    ┌────────────────────┼────────────────────┐              │
│    │                    │                    │              │
│    ▼                    ▼                    ▼              │
│ RDS SQL Server    Workspaces         IAM Identity Center    │
│ WorkDocs          QuickSight         Apps tradicionales     │
│ Connect           FSx                (SharePoint, SQL)      │
└─────────────────────────────────────────────────────────────┘
```

### Conexión con On-Premise (Two-Way Forest Trust):

```
┌──────────────────┐                    ┌──────────────────┐
│   ON-PREMISE     │   Direct Connect   │      AWS VPC     │
│                  │        o VPN       │                  │
│  Microsoft AD    │◄──────────────────►│  AWS Managed AD  │
│  (dominio A)     │                    │  (dominio B)     │
│                  │   TWO-WAY TRUST    │                  │
└──────────────────┘                    └──────────────────┘

Trust ≠ Replicación
- Usuarios viven independientes en cada AD
- Trust permite consultar al otro si falta un usuario
```

### Arquitectura con Réplica (Para DR):

```
ON-PREMISE                          AWS VPC
┌──────────────┐                   ┌──────────────────────────┐
│              │   Direct Connect  │                          │
│  Microsoft   │◄─────────────────►│  EC2 con AD (réplica)   │
│  AD          │   Replicación     │         │                │
│              │                   │         │ Two-way Trust  │
└──────────────┘                   │         ▼                │
                                   │  AWS Managed AD          │
                                   └──────────────────────────┘
```

---

## 2. AD Connector

### Características:
- **Proxy** hacia tu AD on-premise
- NO almacena usuarios en AWS
- Usuarios se gestionan SOLO on-premise
- Soporta MFA
- Requiere VPN o Direct Connect

### Flujo:

```
Usuario → Página Login → AD Connector (proxy en EC2)
                              │
                              │ VPN/Direct Connect
                              ▼
                         AD On-Premise
                              │
                              │ LDAP auth
                              ▼
                         AD Connector → STS AssumeRole
                              │
                              ▼
                         Credenciales AWS
```

### Limitaciones:
- Si VPN/Direct Connect cae → No funciona
- No soporta SQL Server, Seamless Domain Join, etc.

---

## 3. Simple AD

### Características:
- AD básico compatible (Samba)
- Más barato
- 500 a 5000 usuarios
- Standalone (NO se conecta a on-premise)

### NO soporta:
- ❌ MFA
- ❌ Trust con AD on-premise
- ❌ RDS SQL Server
- ❌ SSO

### Cuándo usarlo:
- Necesitás AD básico sin integración on-premise
- Presupuesto limitado
- Pocos usuarios

---

## Comparación Rápida

| Necesidad | Solución |
|-----------|----------|
| AD completo en AWS + integración on-premise | AWS Managed Microsoft AD |
| Usuarios solo on-premise, proxy a AWS | AD Connector |
| AD básico, standalone, bajo costo | Simple AD |
| Integración con RDS SQL Server | AWS Managed Microsoft AD |
| MFA requerido | Managed AD o AD Connector |

---

## Key Points para el Examen

1. **AWS Managed Microsoft AD** = El más completo, soporta Two-Way Forest Trust
2. **AD Connector** = Solo proxy, usuarios on-premise, falla si cae conexión
3. **Simple AD** = Barato, básico, NO MFA, NO trust, standalone
4. **Trust ≠ Replicación** = Trust permite consultar, no sincroniza usuarios
5. **RDS SQL Server** = Solo funciona con AWS Managed Microsoft AD
6. **Multi-AZ** = Managed AD despliega mínimo 2 DCs en diferentes AZs

