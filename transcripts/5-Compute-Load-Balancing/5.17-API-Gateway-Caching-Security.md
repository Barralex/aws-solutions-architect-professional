# 5.17 API Gateway - Caching & Security

## Usage Plans & API Keys

### Usage Plan
- Define quién puede acceder a qué stages/methods
- Cuánto y qué tan rápido pueden acceder
- Throttling limits (requests/segundo)
- Quota limits (requests totales por período)

### API Keys
- String alfanumérico secreto
- Se distribuye a clientes para identificarlos
- Se asocia a Usage Plans
- Permite throttling y quotas por cliente

### Error 429 Too Many Requests
- Throttling a nivel de CUENTA (todas las APIs en la región)
- Cliente debe implementar retry con exponential backoff

## WebSocket API

### Qué es
- Comunicación bidireccional browser ↔ server
- Conexión persistente (stateful)
- Server puede pushear datos al cliente

### Casos de uso
- Chat apps
- Collaboration platforms
- Multiplayer games
- Trading platforms

### Arquitectura
```
Cliente ──WebSocket──► API GW ──► Lambda (onConnect)
                                  Lambda (sendMessage)
                                  Lambda (onDisconnect)
```

### @connections Callback
- URL especial para enviar datos de vuelta al cliente
- `POST /@connections/{connectionId}`
- Lambda postea a esta URL → API GW envía al cliente

## Private APIs

### Acceso
- Solo desde VPC via Interface Endpoint
- Un endpoint puede acceder múltiples private APIs

### Seguridad (2 niveles)
1. **VPC Endpoint Policy** - controla acceso al endpoint
2. **API Gateway Resource Policy** - allow/deny por VPC, VPC Endpoints, cross-account

### Condiciones en Resource Policy
- `aws:SourceVpc` - restringir por VPC
- `aws:SourceVpce` - restringir por VPC Endpoint específico
