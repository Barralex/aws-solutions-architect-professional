# 5.4 Auto Scaling

**Curso:** AWS Solutions Architect Professional (SAP-C02)
**Sección:** 5 - Compute & Load Balancing
**Duración:** ~8 min

---

## Resumen

ASG scaling policies: Target Tracking (simple), Step Scaling (CloudWatch alarms), Scheduled Actions (eventos conocidos), Predictive Scaling (ML forecast). Instance Refresh para actualizar AMI. Health checks críticos - deben ser simples.

---

## Tipos de Scaling Policies

### 1. Target Tracking (más simple)
```
"Mantené el CPU promedio en 40%"
→ ASG agrega/quita instancias automáticamente
```

### 2. Step Scaling (más control)
```
CloudWatch Alarm: CPU > 70% → add 2 instances
CloudWatch Alarm: CPU < 30% → remove 1 instance
```

### 3. Scheduled Actions (eventos conocidos)
```
"Viernes 5PM hay promo → min capacity = 10"
```

### 4. Predictive Scaling (ML)
```
AWS analiza histórico → forecast → escala ANTES de que pase
```

---

## Métricas para escalar

| Métrica | Caso de uso |
|---------|-------------|
| **CPU Utilization** | General |
| **Request Count Per Target** | Apps web (ej: 1000 req/instancia) |
| **Network In/Out** | Apps que suben/bajan archivos |
| **Custom Metric** | Lo que quieras via CloudWatch |

---

## Instance Refresh (actualizar AMI)

```
1. Subes nuevo Launch Template con nueva AMI
2. Llamas API: StartInstanceRefresh
3. Especificas: MinHealthyPercentage (ej: 60%)
4. ASG termina instancias de a poco y crea nuevas
5. Warmup time: espera antes de seguir
```

---

## Procesos del ASG (se pueden suspender)

| Proceso | Qué hace |
|---------|----------|
| **Launch** | Agrega instancias |
| **Terminate** | Quita instancias |
| **HealthCheck** | Chequea salud |
| **ReplaceUnhealthy** | Reemplaza instancias malas |
| **AZRebalance** | Balancea entre AZs |
| **AlarmNotification** | Recibe alarmas CloudWatch |
| **ScheduledActions** | Ejecuta acciones programadas |
| **AddToLoadBalancer** | Agrega a ELB/Target Group |
| **InstanceRefresh** | Actualiza instancias |

Tip: Suspender **ReplaceUnhealthy** para debuggear instancias failing.

---

## Health Checks

| Tipo | Basado en |
|------|-----------|
| **EC2 Status Check** | Hardware/sistema |
| **ELB Health Check** | HTTP response |

### IMPORTANTE: Health check debe ser SIMPLE

```
BUENO: /health → responde "OK" inmediatamente

MALO: /customers/count → hace query a DB →
      si DB lenta o falla → ASG piensa que EC2 está muerta →
      termina todas las instancias → desastre
```

---

## Puntos Clave Examen

1. **Target Tracking** = más simple, solo define target
2. **Predictive Scaling** = ML, escala ANTES basado en histórico
3. **Instance Refresh** = actualizar AMI sin downtime
4. **Health check simple** = no hacer cosas pesadas en el health check
5. **Suspender procesos** = útil para debugging

